---
title: "Class09: Structural Bioinformatics Pt 1"
author: "Montserrat (PID:A16536527)"
format: pdf
---

## The PDB database 

The main repository for biomolecular structure data is the Protein Data Bank (PDB) https://www.rcsb.org

Lets have a quick look at the composition of this database 

```{r}
stats<-read.csv("Data Export Summary.csv")
stats
```
>Q1: What percentage of structures in the PDB are solved by X-Ray and Electron Microscopy.

```{r}
as.numeric(sub(",","",stats$X.ray))
```
This is annoying lets try a different import function from the **readr** package

```{r}
library(readr)

stats<-read_csv("Data Export Summary.csv")
stats

```

Percent X.ray 

```{r}
n.total<-sum(stats$Total)
n.xray<-sum(stats$`X-ray`)
round(n.xray/n.total *100,2)
```
Percent EM

```{r}
n.EM <-sum(stats$`EM`)
round(n.EM/n.total *100,2)
```
>Q2: What proportion of structures in the PDB are protein?

```{r}
n.protein <-stats$Total[1]
n.protein/n.total
```

>Q3: Make a bar plot overview. 

```{r}
library(ggplot2)
ggplot(stats)+ 
  aes(reorder(`Molecular Type`,-Total),Total)+
geom_col()
 

 

```

## Visualizing structure data 

The Mol* viewer is embedded in may bioinformatics websites.The homepage is https://molstar.org

I can insert any figure or image file using markdown format 

![The HIV-Pr dimer with bound inhibitor](1HSG.png)
Notice inside square brackets you can put caption 

![The catalytic ASP2](1HSG2.png)

##Bio3D package for structural bioinformatics 

We can use the bio3d package to read and analyze biomolecular data in R:
```{r}
library(bio3d)
hiv<- read.pdb("1hsg")
hiv
```

```{r}
head(hiv$atom)
```

Lets get the sequence 

```{r}
pdbseq(hiv)
```

Lets trim to chain A and get just its sequence 

```{r}
chainA<-trim.pdb(hiv,chain="A")
chainA.seq<-pdbseq(chainA)
```

Lets blast 

```{r blast_hiv,cache=TRUE}
#this code saves your results so that every time you render it does not have to rerun this big data over and over again 
blast<-blast.pdb(chainA.seq)
```
```{r}
head(blast$hit.tbl)
```

Plot a quick overview of blast results 

```{r}
hits<-plot(blast)

```
```{r}
hits$pdb.id
```
## Prediction of functional motions 

We can run a Normal Mode Analysis (NMA) to predict large scale motions/flexibility/dynamics of any biomolecule that we can read into R 

Lets look at ADK and chain A only!

```{r}
adk <-read.pdb("1ake")

adk_A<-trim.pdb(adk,chain="A")
adk_A

```

```{r}
m<-nma(adk_A)
plot(m)
```

Lets write out a "trajectory" of predicted motion 

```{r}
mktrj(m,file="adk_nma.pdb")
```

## Play with 3D viewing in R 

We can use the new **bio3dview** package, which is not yet on CRAN, to render interactive 3D views in R and HTML quarto output reports.

To install from GitHub we can use the **pak** package 

```{r}
library(bio3dview)
view.pdb(adk)
```

## Comparitive analysis of protein structures

starting with sequence or structure ID (accession number) lets run a complete analysis pipeline 

```{r}
library(bio3d)
id<-"1ake_A"
aa<- get.seq(id)
aa
```

```{r, cache=TRUE}
blast <- blast.pdb(aa)
hits <-plot(blast)
```

```{r}
hits$pdb.id
```

Download all these "hits" that are similar to our starting id sequence 
```{r}
# Download releated PDB files
files <- get.pdb(hits$pdb.id, path="pdbs", split=TRUE, gzip=TRUE)
```

```{r}

install.packages("bio3d")
install.packages("devtools")
install.packages("BiocManager")
# Align releated PDBs
pdbs <- pdbaln(files, fit = TRUE, exefile="msa")
```


```{r}
# Vector containing PDB codes for figure axis
ids <- basename.pdb(pdbs$id)

# Draw schematic alignment
plot(pdbs, labels=ids)
```

Annotate collected PDB strucutres

```{r}
anno <- pdb.annotate(ids)
unique(anno$source)
anno
```

Principal component analysis 

```{r}
# Perform PCA
pc.xray <- pca(pdbs)
plot(pc.xray)
```
Optional: View our superposed structures 

```{r}
# Calculate RMSD
rd <- rmsd(pdbs)

# Structure-based clustering
hc.rd <- hclust(dist(rd))
grps.rd <- cutree(hc.rd, k=3)

plot(pc.xray, 1:2, col="grey50", bg=grps.rd, pch=21, cex=1)
```


```{r}
mktrj(pc.xray,file="pca_results.pdb")
```
then you open up this file on molstar viewer 


```{r}
library (bio3dview)
view.pca(pc.xray)
```

